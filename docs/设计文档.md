# CleanMyDeepin 项目设计文档

## 一、架构设计

本项目采用 QML + C++ 技术栈，前端界面使用 QML 实现，后端逻辑与系统操作由 C++ 实现，通过 Qt 的信号槽机制进行通信。整体采用前后端分离、模块化设计，保证良好的可维护性与扩展性。

### 1. 总体架构图

```
+-------------------+         +-------------------+
|    QML 前端界面    | <-----> |   C++ 后端逻辑     |
+-------------------+         +-------------------+
         |                              |
         |         Qt 信号/槽           |
         +------------------------------+
```

- QML 负责 UI 展示、用户交互、动画效果等。
- C++ 负责文件扫描、清理、系统操作、配置管理等。
- 二者通过 Qt 的 Q_PROPERTY、信号槽、Q_INVOKABLE 等机制通信。

## 二、主要模块划分

1. **界面层（QML）**
   - 主窗口（MainWindow）
   - 扫描页（ScanPage）
   - 清理页（CleanPage）
   - 设置页（SettingsPage）
   - 帮助页（HelpPage）
   - 公共组件（进度条、弹窗、树形视图等）

2. **逻辑层（C++）**
   - 扫描管理器（ScanManager）
   - 清理管理器（CleanManager）
   - 配置管理器（ConfigManager）
   - 日志与异常处理（Logger）
   - 本地化支持（Translator）

## 三、关键流程设计

### 1. 扫描流程

- 用户点击"扫描"按钮
- QML 触发信号，调用 C++ ScanManager::startScan()
- ScanManager 按类型/目录扫描垃圾文件，实时通过信号反馈进度、当前状态、已发现文件数
- QML 进度条、状态文本实时更新，支持"中断"按钮
- 扫描完成后，ScanManager 返回结果，QML 跳转到清理页并展示树状文件列表

### 2. 清理流程

- 用户在清理页勾选/全选垃圾项
- 点击"清理"按钮，弹出二次确认弹窗
- 确认后，QML 调用 C++ CleanManager::startClean()
- CleanManager 依次删除选中文件，实时反馈进度、当前处理项
- 清理完成后，返回结果（释放空间、失败项），QML 弹窗提示

### 3. 设置与帮助

- 设置页通过 QML 绑定 ConfigManager，支持开机自启、忽略目录等配置
- 帮助页展示内置文档，支持常见问题解答

## 四、界面结构草图

- 主窗口：左侧标签栏（扫描、清理、设置、帮助），右侧为对应页面内容
- 扫描页：大按钮+进度条+状态文本+中断按钮
- 清理页：树形文件视图+勾选框+全选/反选+底部清理按钮
- 设置页：开机自启、忽略目录/类型列表、保存按钮
- 帮助页：功能说明、FAQ

## 五、技术实现要点

- **QML 动画与深色/浅色自适应**：使用 Qt Quick Controls 2，支持主题切换，动画流畅
- **C++ 文件操作权限**：需适配 deepin 权限模型，部分操作需 sudo/提权
- **进度与中断机制**：扫描/清理过程采用异步线程，支持实时进度与中断
- **树形数据结构**：扫描结果以树形结构传递给 QML，支持分组与展开
- **本地化**：采用 Qt Linguist，支持多语言切换
- **异常与安全保护**：关键目录保护、二次确认、失败友好提示

## 六、后续扩展建议

- 支持定时清理、清理历史、插件扩展等
- 深度清理、智能推荐等高级功能
- UI 进一步美化，适配更多分辨率

---

本设计文档为 CleanMyDeepin 项目开发的技术蓝图，后续可根据实际开发情况进行细化和调整。